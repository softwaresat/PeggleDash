#include "Ball.h"
#include "GameObject.h"
#include <cstdint>
#include <iostream>


const int32_t angleToVel[201][3]= {
        {   0,  128, -222 }, // pot=0.00, angle=-60.0°
        {   3,  133, -219 }, // pot=0.01, angle=-58.8°
        {   5,  137, -216 }, // pot=0.02, angle=-57.6°
        {   8,  142, -213 }, // pot=0.03, angle=-56.4°
        {  10,  146, -210 }, // pot=0.04, angle=-55.2°
        {  13,  150, -207 }, // pot=0.05, angle=-54.0°
        {  15,  155, -204 }, // pot=0.06, angle=-52.8°
        {  18,  159, -201 }, // pot=0.07, angle=-51.6°
        {  20,  163, -197 }, // pot=0.08, angle=-50.4°
        {  23,  167, -194 }, // pot=0.09, angle=-49.2°
        {  26,  171, -190 }, // pot=0.10, angle=-48.0°
        {  28,  175, -187 }, // pot=0.11, angle=-46.8°
        {  31,  179, -183 }, // pot=0.12, angle=-45.6°
        {  33,  183, -179 }, // pot=0.13, angle=-44.4°
        {  36,  187, -175 }, // pot=0.14, angle=-43.2°
        {  38,  190, -171 }, // pot=0.15, angle=-42.0°
        {  41,  194, -167 }, // pot=0.16, angle=-40.8°
        {  44,  197, -163 }, // pot=0.17, angle=-39.6°
        {  46,  201, -159 }, // pot=0.18, angle=-38.4°
        {  49,  204, -155 }, // pot=0.19, angle=-37.2°
        {  51,  207, -150 }, // pot=0.20, angle=-36.0°
        {  54,  210, -146 }, // pot=0.21, angle=-34.8°
        {  56,  213, -142 }, // pot=0.22, angle=-33.6°
        {  59,  216, -137 }, // pot=0.23, angle=-32.4°
        {  61,  219, -133 }, // pot=0.24, angle=-31.2°
        {  64,  222, -128 }, // pot=0.25, angle=-30.0°
        {  67,  224, -123 }, // pot=0.26, angle=-28.8°
        {  69,  227, -119 }, // pot=0.27, angle=-27.6°
        {  72,  229, -114 }, // pot=0.28, angle=-26.4°
        {  74,  232, -109 }, // pot=0.29, angle=-25.2°
        {  77,  234, -104 }, // pot=0.30, angle=-24.0°
        {  79,  236,  -99 }, // pot=0.31, angle=-22.8°
        {  82,  238,  -94 }, // pot=0.32, angle=-21.6°
        {  84,  240,  -89 }, // pot=0.33, angle=-20.4°
        {  87,  242,  -84 }, // pot=0.34, angle=-19.2°
        {  90,  243,  -79 }, // pot=0.35, angle=-18.0°
        {  92,  245,  -74 }, // pot=0.36, angle=-16.8°
        {  95,  247,  -69 }, // pot=0.37, angle=-15.6°
        {  97,  248,  -64 }, // pot=0.38, angle=-14.4°
        { 100,  249,  -58 }, // pot=0.39, angle=-13.2°
        { 102,  250,  -53 }, // pot=0.40, angle=-12.0°
        { 105,  251,  -48 }, // pot=0.41, angle=-10.8°
        { 108,  252,  -43 }, // pot=0.42, angle=-9.6°
        { 110,  253,  -37 }, // pot=0.43, angle=-8.4°
        { 113,  254,  -32 }, // pot=0.44, angle=-7.2°
        { 115,  255,  -27 }, // pot=0.45, angle=-6.0°
        { 118,  255,  -21 }, // pot=0.46, angle=-4.8°
        { 120,  255,  -16 }, // pot=0.47, angle=-3.6°
        { 123,  256,  -11 }, // pot=0.48, angle=-2.4°
        { 125,  256,   -5 }, // pot=0.49, angle=-1.2°
        { 128,  256,    0 }, // pot=0.50, angle=0.0°
        { 131,  256,    5 }, // pot=0.51, angle=1.2°
        { 133,  256,   11 }, // pot=0.52, angle=2.4°
        { 136,  255,   16 }, // pot=0.53, angle=3.6°
        { 138,  255,   21 }, // pot=0.54, angle=4.8°
        { 141,  255,   27 }, // pot=0.55, angle=6.0°
        { 143,  254,   32 }, // pot=0.56, angle=7.2°
        { 146,  253,   37 }, // pot=0.57, angle=8.4°
        { 148,  252,   43 }, // pot=0.58, angle=9.6°
        { 151,  251,   48 }, // pot=0.59, angle=10.8°
        { 154,  250,   53 }, // pot=0.60, angle=12.0°
        { 156,  249,   58 }, // pot=0.61, angle=13.2°
        { 159,  248,   64 }, // pot=0.62, angle=14.4°
        { 161,  247,   69 }, // pot=0.63, angle=15.6°
        { 164,  245,   74 }, // pot=0.64, angle=16.8°
        { 166,  243,   79 }, // pot=0.65, angle=18.0°
        { 169,  242,   84 }, // pot=0.66, angle=19.2°
        { 172,  240,   89 }, // pot=0.67, angle=20.4°
        { 174,  238,   94 }, // pot=0.68, angle=21.6°
        { 177,  236,   99 }, // pot=0.69, angle=22.8°
        { 179,  234,  104 }, // pot=0.70, angle=24.0°
        { 182,  232,  109 }, // pot=0.71, angle=25.2°
        { 184,  229,  114 }, // pot=0.72, angle=26.4°
        { 187,  227,  119 }, // pot=0.73, angle=27.6°
        { 189,  224,  123 }, // pot=0.74, angle=28.8°
        { 192,  222,  128 }, // pot=0.75, angle=30.0°
        { 195,  219,  133 }, // pot=0.76, angle=31.2°
        { 197,  216,  137 }, // pot=0.77, angle=32.4°
        { 200,  213,  142 }, // pot=0.78, angle=33.6°
        { 202,  210,  146 }, // pot=0.79, angle=34.8°
        { 205,  207,  150 }, // pot=0.80, angle=36.0°
        { 207,  204,  155 }, // pot=0.81, angle=37.2°
        { 210,  201,  159 }, // pot=0.82, angle=38.4°
        { 212,  197,  163 }, // pot=0.83, angle=39.6°
        { 215,  194,  167 }, // pot=0.84, angle=40.8°
        { 218,  190,  171 }, // pot=0.85, angle=42.0°
        { 220,  187,  175 }, // pot=0.86, angle=43.2°
        { 223,  183,  179 }, // pot=0.87, angle=44.4°
        { 225,  179,  183 }, // pot=0.88, angle=45.6°
        { 228,  175,  187 }, // pot=0.89, angle=46.8°
        { 230,  171,  190 }, // pot=0.90, angle=48.0°
        { 233,  167,  194 }, // pot=0.91, angle=49.2°
        { 236,  163,  197 }, // pot=0.92, angle=50.4°
        { 238,  159,  201 }, // pot=0.93, angle=51.6°
        { 241,  155,  204 }, // pot=0.94, angle=52.8°
        { 243,  150,  207 }, // pot=0.95, angle=54.0°
        { 246,  146,  210 }, // pot=0.96, angle=55.2°
        { 248,  142,  213 }, // pot=0.97, angle=56.4°
        { 251,  137,  216 }, // pot=0.98, angle=57.6°
        { 253,  133,  219 }, // pot=0.99, angle=58.8°
        { 256,  128,  222 }, // pot=1.00, angle=60.0°
        { 259,  123,  224 }, // pot=1.01, angle=61.2°
        { 261,  119,  227 }, // pot=1.02, angle=62.4°
        { 264,  114,  229 }, // pot=1.03, angle=63.6°
        { 266,  109,  232 }, // pot=1.04, angle=64.8°
        { 269,  104,  234 }, // pot=1.05, angle=66.0°
        { 271,   99,  236 }, // pot=1.06, angle=67.2°
        { 274,   94,  238 }, // pot=1.07, angle=68.4°
        { 276,   89,  240 }, // pot=1.08, angle=69.6°
        { 279,   84,  242 }, // pot=1.09, angle=70.8°
        { 282,   79,  243 }, // pot=1.10, angle=72.0°
        { 284,   74,  245 }, // pot=1.11, angle=73.2°
        { 287,   69,  247 }, // pot=1.12, angle=74.4°
        { 289,   64,  248 }, // pot=1.13, angle=75.6°
        { 292,   58,  249 }, // pot=1.14, angle=76.8°
        { 294,   53,  250 }, // pot=1.15, angle=78.0°
        { 297,   48,  251 }, // pot=1.16, angle=79.2°
        { 300,   43,  252 }, // pot=1.17, angle=80.4°
        { 302,   37,  253 }, // pot=1.18, angle=81.6°
        { 305,   32,  254 }, // pot=1.19, angle=82.8°
        { 307,   27,  255 }, // pot=1.20, angle=84.0°
        { 310,   21,  255 }, // pot=1.21, angle=85.2°
        { 312,   16,  255 }, // pot=1.22, angle=86.4°
        { 315,   11,  256 }, // pot=1.23, angle=87.6°
        { 317,    5,  256 }, // pot=1.24, angle=88.8°
        { 320,    0,  256 }, // pot=1.25, angle=90.0°
        { 323,   -5,  256 }, // pot=1.26, angle=91.2°
        { 325,  -11,  256 }, // pot=1.27, angle=92.4°
        { 328,  -16,  255 }, // pot=1.28, angle=93.6°
        { 330,  -21,  255 }, // pot=1.29, angle=94.8°
        { 333,  -27,  255 }, // pot=1.30, angle=96.0°
        { 335,  -32,  254 }, // pot=1.31, angle=97.2°
        { 338,  -37,  253 }, // pot=1.32, angle=98.4°
        { 340,  -43,  252 }, // pot=1.33, angle=99.6°
        { 343,  -48,  251 }, // pot=1.34, angle=100.8°
        { 346,  -53,  250 }, // pot=1.35, angle=102.0°
        { 348,  -58,  249 }, // pot=1.36, angle=103.2°
        { 351,  -64,  248 }, // pot=1.37, angle=104.4°
        { 353,  -69,  247 }, // pot=1.38, angle=105.6°
        { 356,  -74,  245 }, // pot=1.39, angle=106.8°
        { 358,  -79,  243 }, // pot=1.40, angle=108.0°
        { 361,  -84,  242 }, // pot=1.41, angle=109.2°
        { 364,  -89,  240 }, // pot=1.42, angle=110.4°
        { 366,  -94,  238 }, // pot=1.43, angle=111.6°
        { 369,  -99,  236 }, // pot=1.44, angle=112.8°
        { 371, -104,  234 }, // pot=1.45, angle=114.0°
        { 374, -109,  232 }, // pot=1.46, angle=115.2°
        { 376, -114,  229 }, // pot=1.47, angle=116.4°
        { 379, -119,  227 }, // pot=1.48, angle=117.6°
        { 381, -123,  224 }, // pot=1.49, angle=118.8°
        { 384, -128,  222 }, // pot=1.50, angle=120.0°
        { 387, -133,  219 }, // pot=1.51, angle=121.2°
        { 389, -137,  216 }, // pot=1.52, angle=122.4°
        { 392, -142,  213 }, // pot=1.53, angle=123.6°
        { 394, -146,  210 }, // pot=1.54, angle=124.8°
        { 397, -150,  207 }, // pot=1.55, angle=126.0°
        { 399, -155,  204 }, // pot=1.56, angle=127.2°
        { 402, -159,  201 }, // pot=1.57, angle=128.4°
        { 404, -163,  197 }, // pot=1.58, angle=129.6°
        { 407, -167,  194 }, // pot=1.59, angle=130.8°
        { 410, -171,  190 }, // pot=1.60, angle=132.0°
        { 412, -175,  187 }, // pot=1.61, angle=133.2°
        { 415, -179,  183 }, // pot=1.62, angle=134.4°
        { 417, -183,  179 }, // pot=1.63, angle=135.6°
        { 420, -187,  175 }, // pot=1.64, angle=136.8°
        { 422, -190,  171 }, // pot=1.65, angle=138.0°
        { 425, -194,  167 }, // pot=1.66, angle=139.2°
        { 428, -197,  163 }, // pot=1.67, angle=140.4°
        { 430, -201,  159 }, // pot=1.68, angle=141.6°
        { 433, -204,  155 }, // pot=1.69, angle=142.8°
        { 435, -207,  150 }, // pot=1.70, angle=144.0°
        { 438, -210,  146 }, // pot=1.71, angle=145.2°
        { 440, -213,  142 }, // pot=1.72, angle=146.4°
        { 443, -216,  137 }, // pot=1.73, angle=147.6°
        { 445, -219,  133 }, // pot=1.74, angle=148.8°
        { 448, -222,  128 }, // pot=1.75, angle=150.0°
        { 451, -224,  123 }, // pot=1.76, angle=151.2°
        { 453, -227,  119 }, // pot=1.77, angle=152.4°
        { 456, -229,  114 }, // pot=1.78, angle=153.6°
        { 458, -232,  109 }, // pot=1.79, angle=154.8°
        { 461, -234,  104 }, // pot=1.80, angle=156.0°
        { 463, -236,   99 }, // pot=1.81, angle=157.2°
        { 466, -238,   94 }, // pot=1.82, angle=158.4°
        { 468, -240,   89 }, // pot=1.83, angle=159.6°
        { 471, -242,   84 }, // pot=1.84, angle=160.8°
        { 474, -243,   79 }, // pot=1.85, angle=162.0°
        { 476, -245,   74 }, // pot=1.86, angle=163.2°
        { 479, -247,   69 }, // pot=1.87, angle=164.4°
        { 481, -248,   64 }, // pot=1.88, angle=165.6°
        { 484, -249,   58 }, // pot=1.89, angle=166.8°
        { 486, -250,   53 }, // pot=1.90, angle=168.0°
        { 489, -251,   48 }, // pot=1.91, angle=169.2°
        { 492, -252,   43 }, // pot=1.92, angle=170.4°
        { 494, -253,   37 }, // pot=1.93, angle=171.6°
        { 497, -254,   32 }, // pot=1.94, angle=172.8°
        { 499, -255,   27 }, // pot=1.95, angle=174.0°
        { 502, -255,   21 }, // pot=1.96, angle=175.2°
        { 504, -255,   16 }, // pot=1.97, angle=176.4°
        { 507, -256,   11 }, // pot=1.98, angle=177.6°
        { 509, -256,    5 }, // pot=1.99, angle=178.8°
        { 512, -256,    0 }, // pot=2.00, angle=180.0°
    };

static uint16_t ballSprite[16][16] = {
    { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x31A6, 0x31C6, 0x31C6, 0x31C6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x0000, 0x31A6, 0x3A28, 0x536F, 0x6412, 0x6C33, 0x6BF1, 0x4249, 0x31C7, 0x0000, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x31A6, 0x534E, 0x7495, 0x7CD6, 0x8D78, 0x9DB9, 0x9598, 0x8517, 0x5B8F, 0x31A6, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x31A6, 0x534E, 0x7CD6, 0x8517, 0x8D99, 0xB67B, 0xD73D, 0xBEBB, 0x9578, 0x8537, 0x5B4E, 0x3186, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x3A07, 0x7CD6, 0x8517, 0x8D78, 0x95BA, 0xC6FC, 0xF7FE, 0xDF3D, 0xA5F9, 0x8D77, 0x84F5, 0x39E7, 0x0000, 0x0000 },
    { 0x0000, 0x39C6, 0x84B3, 0x9DB8, 0x9577, 0x9576, 0x9556, 0xA596, 0xB618, 0xADD7, 0x9CF2, 0xAC2C, 0xABA9, 0x7AA5, 0x3184, 0x0000 },
    { 0x0000, 0x39C6, 0xA534, 0xA575, 0xA4D1, 0xAC6D, 0xAC0B, 0xB3A7, 0xB3A6, 0xBBA6, 0xBBA5, 0xBB64, 0xBB42, 0xA302, 0x3964, 0x0000 },
    { 0x0000, 0x30E2, 0x9AC3, 0xB342, 0xBBC2, 0xC402, 0xC3E2, 0xC3E2, 0xC402, 0xCC22, 0xCC42, 0xCC42, 0xC443, 0xABC3, 0x3102, 0x0000 },
    { 0x0000, 0x30E2, 0xA322, 0xCC42, 0xD4E2, 0xD4E2, 0xD4E2, 0xD4E2, 0xD4E3, 0xD4E3, 0xD4E3, 0xD4E3, 0xCCA3, 0xABC3, 0x3102, 0x0000 },
    { 0x0000, 0x30E2, 0xA383, 0xD504, 0xEE26, 0xEE26, 0xE605, 0xE5C4, 0xDD84, 0xDD64, 0xDD84, 0xCD24, 0xBC64, 0x9B63, 0x30E2, 0x0000 },
    { 0x0000, 0x0000, 0x59E2, 0xC483, 0xF6C9, 0xFF2A, 0xEEA7, 0xE5E5, 0xD584, 0xD565, 0xCD25, 0xBC85, 0xABE5, 0x59E3, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x30E2, 0x9345, 0xBCA6, 0xCD06, 0xCD25, 0xC4E5, 0xC4C5, 0xBC86, 0xB487, 0xB488, 0x9BC8, 0x3123, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x49A4, 0x8B68, 0x9BA9, 0x9BC9, 0xAC4A, 0xAC6A, 0xB46A, 0xBCED, 0xAC8E, 0x51E6, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x0000, 0x51E6, 0x836B, 0xACB0, 0xC594, 0xCDB4, 0xB532, 0x9C2D, 0x5A26, 0x0000, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x2082, 0x6ACA, 0x83AD, 0x838C, 0x5A68, 0x2082, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
    { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
};

uint16_t tableLength = 201;

Ball::Ball(int32_t angle) 
{

    uint32_t angleIndex = angleToIndex(angle);
    active = true;
    x = 64*256;
    y = 80*256;
    vx = angleToVel[angleIndex][1];
    vy = angleToVel[angleIndex][2];
    image = &ballSprite[0][0];
    h = 16;
    w = 16;
}

void Ball::moveBall(){
    x += vx;
    y -= vy;

    if(x >= 128*256 || x <= 0){
        vx = -vx;
    }
    if(y >= 160*256 || y <= 0){
        vy = -vy;
    }
}

int32_t Ball::angleToIndex(int32_t angle){
    for(int32_t i = 0; i < tableLength; i++){
        if(angleToVel[i][0] == angle){
            return i;
        }
    }
    return -1;
}

void Ball::reset(int32_t angle){
    uint32_t angleIndex = angleToIndex(angle);
    active = true;
    x = 64*256;
    y = 80*256;
    vx = angleToVel[angleIndex][1];
    vy = angleToVel[angleIndex][2];
}

bool Ball::getActive(){
    return active;
}